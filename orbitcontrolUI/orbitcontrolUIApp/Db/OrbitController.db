### NOTE: "Initializing" mode is not set-able through the UI
record(mbbo, "OrbitController:mode") {
	field(DTYP, "OrbitController Mbbio")
	field(OMSL, "supervisory")
	field(DOL, "0")
	field(OUT, "@mode")
	field(ONVL, "1")
	field(TWVL, "2")
	field(THVL, "3")
	field(FRVL, "4")
	field(FVVL, "5")
	field(ONST, "Standby")
	field(TWST, "Assisted")
	field(THST, "Autonomous")
	field(FRST, "Timed")
	field(FVST, "Testing")
}

record(mbbi, "OrbitController:mode:fbk") {
	field(DTYP, "OrbitController Mbbio")
	field(PINI, "1")
	field(SCAN, "Event")
	field(EVNT, "$(modeChangeEvent)")
	field(INP, "@mode")
	field(ZRVL, "0")
	field(ONVL, "1")
	field(TWVL, "2")
	field(THVL, "3")
	field(FRVL, "4")
	field(FVVL, "5")
	field(ZRST, "Initializing")
	field(ONST, "Standby")
	field(TWST, "Assisted")
	field(THST, "Autonomous")
	field(FRST, "Timed")
	field(FVST, "Testing")
}

### if beam-current is < 2.5 mA, ensure we get set to Assisted mode!!!
record(calcout, "OrbitController:pct:monitor") {
	field(SCAN, "Passive")
	field(INPA,"PCT1402-01:mA:fbk CPP") #this is our trigger
	field(INPB, "2.5")
	field(INPC, "OrbitController:mode:fbk NPP")
	field(CALC, "A<B?2:C)
	field(OUT, "OrbitController:mode")
	field(OOPT, "On Change")
}

### FIXME!!!
#record(ai, "OrbitController:sampleRate:fbk") {
#	field(DTYP, "OrbitController AnalogIn")
#}